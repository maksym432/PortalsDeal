<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PortalsDeal - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏</title>
    <link rel="stylesheet" href="assets/styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <!-- Stars animation background -->
    <div class="stars">
        <div class="star" style="top: 20%; left: 15%; animation-delay: 0s"></div>
        <div class="star" style="top: 35%; left: 80%; animation-delay: 1s"></div>
        <div class="star" style="top: 60%; left: 25%; animation-delay: 2s"></div>
        <div class="star" style="top: 80%; left: 70%; animation-delay: 0.5s"></div>
        <div class="star" style="top: 10%; left: 60%; animation-delay: 1.5s"></div>
        <div class="star" style="top: 45%; left: 10%; animation-delay: 2.5s"></div>
        <div class="star" style="top: 75%; left: 90%; animation-delay: 0.8s"></div>
        <div class="star" style="top: 25%; left: 45%; animation-delay: 1.8s"></div>
    </div>

    <main>
        <!-- Home Screen -->
        <section id="screen-home" class="screen active" aria-labelledby="tab-home">
            <div class="container">
                <!-- Desktop Navigation -->
                <nav class="desktop-nav">
                    <div class="nav-links">
                        <button class="nav-link active" data-target="#screen-home">
                            <span class="nav-icon">üè†</span>
                            –ì–ª–∞–≤–Ω–∞—è
                        </button>
                        <button class="nav-link" data-target="#screen-profile">
                            <span class="nav-icon">üë§</span>
                            –ü—Ä–æ—Ñ–∏–ª—å
                        </button>
                    </div>
                </nav>

                <!-- Main Header Section -->
                <header class="header">
                    <!-- Mobile mockup -->
                    <div class="mobile-mockup">
                        <div class="mobile-screen">
                            <div class="mobile-header">
                                <span>9:41</span>
                                <div style="display: flex; gap: 4px">
                                    <div style="width: 4px; height: 4px; background: white; border-radius: 50%;"></div>
                                    <div style="width: 14px; height: 8px; border: 1px solid white; border-radius: 2px;"></div>
                                </div>
                            </div>
                            <div class="collections-title">Collections All items</div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 10px;">
                                <span style="color: #999">Search by ID</span>
                                <div style="display: flex; gap: 6px">
                                    <span>Activity</span>
                                    <span>üìÑ</span>
                                    <span>üîΩ</span>
                                </div>
                            </div>
                            <div class="item-grid">
                                <div class="item-card">üê∏<div class="item-price">3,050 TON</div></div>
                                <div class="item-card yellow">üè∫<div class="item-price">Magic Potion</div></div>
                                <div class="item-card">üéÅ<div class="item-price">Gift Box</div></div>
                                <div class="item-card purple">üîÆ</div>
                                <div class="item-card" style="background: linear-gradient(135deg, #4dabf7 0%, #37b24d 100%);">üìÅ</div>
                            </div>
                        </div>
                    </div>
                    <!-- Floating decorative elements -->
                    <div class="floating-elements">
                        <div class="floating-icon nft-icon">üê∏</div>
                        <div class="floating-icon nft-icon">üëú</div>
                        <div class="floating-icon nft-icon">üíé</div>
                        <div class="floating-icon">‚≠ê</div>
                        <div class="floating-icon">üì±</div>
                    </div>
                    <!-- Menu buttons -->
                    <div class="menu-wrap">
                        <div class="menu-title">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</div>
                        <div class="menu">
                            <button class="menu-btn" data-target="#screen-create">
                                <span class="emoji" aria-hidden="true">‚ú®</span>
                                –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É
                            </button>
                            <button class="menu-btn" data-target="#screen-requisites">
                                <span class="emoji" aria-hidden="true">üí≥</span>
                                –ú–æ–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
                            </button>
                            <button class="menu-btn menu-btn--support" data-external="https://t.me/Portaldeal">
                                <span class="emoji" aria-hidden="true">üÜò</span>
                                –ü–æ–¥–¥–µ—Ä–∂–∫–∞
                            </button>
                        </div>
                    </div>
                </header>
                <!-- FAQ Section -->
                <section class="faq-section">
                    <h3 class="faq-title" data-i18n="faq-title">FAQ</h3>
                    <div class="faq-list">
                        <button class="faq-item" onclick="toggleFaq(this)" data-i18n="faq-q1">–ö–∞–∫ –Ω–∞—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∞–º–∏?</button>
                        <div class="faq-answer">
                            <p data-i18n="faq-a1">–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∞–º–∏, –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É" –∏ —Å–ª–µ–¥—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—É —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏. –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–≤–æ–π Telegram –∞–∫–∫–∞—É–Ω—Ç –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–≤–æ—é –ª–∏—á–Ω–æ—Å—Ç—å.</p>
                        </div>
                        <button class="faq-item" onclick="toggleFaq(this)" data-i18n="faq-q2">–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —É –º–µ–Ω—è –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ —Å–¥–µ–ª–∫–æ–π?</button>
                        <div class="faq-answer">
                            <p data-i18n="faq-a2">–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–¥–µ–ª–∫–æ–π, –Ω–∞—à–∞ —Å–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ 24/7 –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ª—é–±—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤. –í—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏ —á–µ—Ä–µ–∑ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: <a href="https://t.me/Portaldeal">@Portaldeal</a>.</p>
                        </div>
                        <button class="faq-item secondary" onclick="toggleFaq(this)" data-i18n="faq-q3">–ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –ø–æ–¥–∞—Ä–∫–∞–º–∏?</button>
                        <div class="faq-answer show">
                            <p data-i18n="faq-a3">–ù–∞—à –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤: —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —à–∏—Ä–æ–∫–∏–π –≤—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤ –∏ –æ—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤. –≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∞–º–∏ –≤ Telegram.</p>
                        </div>
                    </div>
                </section>
            </div>
        </section>
        <!-- Create Deal Screen -->
        <section id="screen-create" class="screen" aria-labelledby="create-title">
            <div class="form-container">
                <div class="form-header">
                    <h1 class="form-title">PortalsDeal</h1>
                    <p class="form-subtitle">–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –≤ Telegram</p>
                </div>
                <div class="form-wrap">
                    <div class="card">
                        <h2 id="create-title">‚ú® –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</h2>
                        <div class="field">
                            <label class="label">–¢–∏–ø —Å–¥–µ–ª–∫–∏:</label>
                            <div class="custom-select" aria-expanded="false">
                                <button type="button" class="cs-trigger" aria-haspopup="listbox" aria-label="–í—ã–±—Ä–∞—Ç—å —Ç–∏–ø —Å–¥–µ–ª–∫–∏">
                                    <span class="cs-left"><span class="emoji">üéÅ</span><span class="cs-value">–ü–æ–¥–∞—Ä–æ–∫</span></span>
                                    <span class="cs-caret">‚ñæ</span>
                                </button>
                                <ul class="cs-list" role="listbox">
                                    <li class="cs-option selected" role="option" data-value="gift"><span class="emoji">üéÅ</span>–ü–æ–¥–∞—Ä–æ–∫</li>
                                    <li class="cs-option" role="option" data-value="channel"><span class="emoji">üì£</span>–ö–∞–Ω–∞–ª/–ß–∞—Ç</li>
                                    <li class="cs-option" role="option" data-value="stars"><span class="emoji">‚≠ê</span>–ó–≤–µ–∑–¥—ã</li>
                                    <li class="cs-option" role="option" data-value="nft"><span class="emoji">üë§</span>NFT –Æ–∑–µ—Ä–Ω–µ–π–º</li>
                                </ul>
                                <input type="hidden" name="dealType" value="gift">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">–í–∞–ª—é—Ç–∞:</label>
                            <div class="custom-select" aria-expanded="false">
                                <button type="button" class="cs-trigger" aria-haspopup="listbox" aria-label="–í—ã–±—Ä–∞—Ç—å –≤–∞–ª—é—Ç—É">
                                    <span class="cs-left"><span class="emoji">üíé</span><span class="cs-value">TON</span></span>
                                    <span class="cs-caret">‚ñæ</span>
                                </button>
                                <ul class="cs-list" role="listbox">
                                    <li class="cs-option" role="option" data-value="RUB"><span class="emoji">üá∑üá∫</span>RUB</li>
                                    <li class="cs-option" role="option" data-value="KGS"><span class="emoji">üá∞üá¨</span>KGS</li>
                                    <li class="cs-option" role="option" data-value="EUR"><span class="emoji">üá™üá∫</span>EUR</li>
                                    <li class="cs-option" role="option" data-value="IDR"><span class="emoji">üáÆüá©</span>IDR</li>
                                    <li class="cs-option" role="option" data-value="UZS"><span class="emoji">üá∫üáø</span>UZS</li>
                                    <li class="cs-option" role="option" data-value="UAH"><span class="emoji">üá∫üá¶</span>UAH</li>
                                    <li class="cs-option" role="option" data-value="KZT"><span class="emoji">üá∞üáø</span>KZT</li>
                                    <li class="cs-option" role="option" data-value="BYN"><span class="emoji">üáßüáæ</span>BYN</li>
                                    <li class="cs-option selected" role="option" data-value="TON"><span class="emoji">üíé</span>TON</li>
                                    <li class="cs-option" role="option" data-value="STARS"><span class="emoji">‚≠ê</span>STARS</li>
                                </ul>
                                <input type="hidden" name="currency" value="TON">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">–°—É–º–º–∞:</label>
                            <input class="input-like" type="number" inputmode="decimal" placeholder="–°—É–º–º–∞" step="0.01" required>
                        </div>
                        <div class="field">
                            <label class="label">–û–ø–∏—Å–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏:</label>
                            <textarea class="input-like" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏"></textarea>
                        </div>
                        <div class="actions">
                            <div id="status-success" class="alert alert-success">
                                <p class="title">‚úÖ –°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!</p>
                                <p style="margin:0">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Ç —Å –±–æ—Ç–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏</p>
                            </div>
                            <div id="status-error" class="alert alert-error"></div>
                            <button id="create-submit" class="btn-wide btn-primary">‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</button>
                            <button class="btn-wide btn-secondary" data-target="#screen-home">‚¨Ö –ù–∞–∑–∞–¥</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Requisites Screen -->
        <section id="screen-requisites" class="screen" aria-labelledby="req-title">
            <div class="form-container">
                <div class="form-header">
                    <h1 class="form-title">PortalsDeal</h1>
                    <p class="form-subtitle">–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –≤ Telegram</p>
                </div>
                <div class="form-wrap">
                    <div class="card">
                        <h2 id="req-title" style="display:flex;align-items:center;gap:10px;">
                            <span style="width:14px;height:14px;display:inline-block;background:#7a8bd0;border-radius:4px;"></span>
                            –ú–æ–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
                        </h2>
                        <div id="requisites-content" style="text-align:center;padding:20px 0 8px;color:#6b778c;">
                            <div style="font-size:44px;">üí≥</div>
                            <div style="margin-top:10px;font-weight:700;">–†–µ–∫–≤–∏–∑–∏—Ç—ã –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã</div>
                        </div>
                        <div class="actions">
                            <button id="add-requisites" class="btn-wide btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</button>
                            <button class="btn-wide btn-secondary" data-target="#screen-home">‚¨Ö –ù–∞–∑–∞–¥</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Profile Screen -->
        <section id="screen-profile" class="screen" aria-labelledby="tab-profile">
            <div class="container">
                <div class="profile-header">
                    <div class="profile-avatar">
                        <div class="avatar-circle">üë§</div>
                    </div>
                    <div class="profile-info">
                        <h1 class="profile-name"></h1>
                        <p class="profile-id"></p>
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="stat-card balance-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-content">
                            <div class="stat-number" id="profile-balance">0.00</div>
                            <div class="stat-label" data-i18n="balance">–ë–∞–ª–∞–Ω—Å</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üéÅ</div>
                        <div class="stat-content">
                            <div class="stat-number" id="profile-deals">0</div>
                            <div class="stat-label" data-i18n="deals-completed">–°–¥–µ–ª–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                        </div>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="action-card primary-action" id="btn-top-up">
                        <div class="action-icon">üí≥</div>
                        <div class="action-content">
                            <h3 data-i18n="top-up-balance">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h3>
                            <p data-i18n="top-up-description">–î–æ–±–∞–≤–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ —Å—á–µ—Ç</p>
                        </div>
                        <div class="action-arrow">‚Üí</div>
                    </button>
                    <button class="action-card" id="btn-statistics" data-target="#screen-statistics">
                        <div class="action-icon">üìä</div>
                        <div class="action-content">
                            <h3 data-i18n="statistics">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            <p data-i18n="statistics-description">–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–∏—Ö —Å–¥–µ–ª–∫–∞—Ö</p>
                        </div>
                        <div class="action-arrow">‚Üí</div>
                    </button>
                </div>
                <div class="profile-settings">
                    <div class="settings-card">
                        <h3 data-i18n="language-settings">–ò–∑–º–µ–Ω–∏—Ç—å —è–∑—ã–∫</h3>
                        <div class="field">
                            <div class="custom-select" aria-expanded="false">
                                <button type="button" class="cs-trigger">
                                    <span class="cs-left">
                                        <span class="emoji">üá∑üá∫</span>
                                        <span class="cs-value">–†—É—Å—Å–∫–∏–π</span>
                                    </span>
                                    <span class="cs-caret">‚ñº</span>
                                </button>
                                <ul class="cs-list">
                                    <li class="cs-option selected" data-value="ru">
                                        <span class="emoji">üá∑üá∫</span>
                                        –†—É—Å—Å–∫–∏–π
                                    </li>
                                    <li class="cs-option" data-value="en">
                                        <span class="emoji">üá∫üá∏</span>
                                        English
                                    </li>
                                </ul>
                                <input type="hidden" name="language" value="ru">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Statistics Screen -->
        <section id="screen-statistics" class="screen" aria-labelledby="btn-statistics">
            <div class="container">
                <div class="form-header">
                    <h1 class="form-title" data-i18n="statistics-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
                    <p class="form-subtitle" data-i18n="statistics-subtitle">–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–∏—Ö —Å–¥–µ–ª–∫–∞—Ö</p>
                </div>
                <div class="form-wrap">
                    <div class="card">
                        <h2 data-i18n="general-stats">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                        <div class="profile-stats">
                            <div class="stat-card">
                                <div class="stat-icon">üìä</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="stats-deals">0</div>
                                    <div class="stat-label" data-i18n="deals-completed">–ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Å–¥–µ–ª–æ–∫</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üí∞</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="stats-total-amount">0</div>
                                    <div class="stat-label" data-i18n="total-amount">–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card" style="margin-top: 2rem;">
                        <h2 data-i18n="recent-deals">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–¥–µ–ª–∫–∏</h2>
                        <div class="transactions-list stagger-animation" id="recent-deals"></div>
                        <div class="actions">
                            <button type="button" class="btn-wide btn-secondary" id="back-to-profile-stats" data-i18n="back-to-profile">–ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Ñ–∏–ª—é</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Bottom Navigation -->
        <nav class="tabbar" role="navigation" aria-label="Bottom navigation">
            <button id="tab-home" class="active" aria-current="page" data-target="#screen-home">
                <span class="icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 3l9 8h-3v9h-5v-6H11v6H6v-9H3l9-8z"/>
                    </svg>
                </span>
                –ì–ª–∞–≤–Ω–∞—è
            </button>
            <button id="tab-profile" data-target="#screen-profile">
                <span class="icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-4.418 0-8 2.239-8 5v2h16v-2c0-2.761-3.582-5-8-5z"/>
                    </svg>
                </span>
                –ü—Ä–æ—Ñ–∏–ª—å
            </button>
        </nav>
    </main>
    <script>
        Telegram.WebApp.ready();
        const user = Telegram.WebApp.initDataUnsafe.user || { id: null, username: 'N/A' };
        const userId = user.id;
        const username = user.username || 'N/A';

        // Language translations
        const translations = {
            ru: {
                profile: '–ü—Ä–æ—Ñ–∏–ª—å',
                statistics: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                balance: '–ë–∞–ª–∞–Ω—Å',
                'deals-completed': '–°–¥–µ–ª–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ',
                'top-up-balance': '–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å',
                'top-up-description': '–î–æ–±–∞–≤–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ —Å—á–µ—Ç',
                'statistics-description': '–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–∏—Ö —Å–¥–µ–ª–∫–∞—Ö',
                'language-settings': '–ò–∑–º–µ–Ω–∏—Ç—å —è–∑—ã–∫',
                'back-to-profile': '–ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Ñ–∏–ª—é',
                'statistics-title': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                'statistics-subtitle': '–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–∏—Ö —Å–¥–µ–ª–∫–∞—Ö',
                'general-stats': '–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                'total-amount': '–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π',
                'recent-deals': '–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–¥–µ–ª–∫–∏',
                'faq-title': 'FAQ',
                'faq-q1': '–ö–∞–∫ –Ω–∞—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∞–º–∏?',
                'faq-a1': '–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∞–º–∏, –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É" –∏ —Å–ª–µ–¥—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—É —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏. –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–≤–æ–π Telegram –∞–∫–∫–∞—É–Ω—Ç –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–≤–æ—é –ª–∏—á–Ω–æ—Å—Ç—å.',
                'faq-q2': '–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —É –º–µ–Ω—è –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ —Å–¥–µ–ª–∫–æ–π?',
                'faq-a2': '–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–¥–µ–ª–∫–æ–π, –Ω–∞—à–∞ —Å–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ 24/7 –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ª—é–±—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤. –í—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏ —á–µ—Ä–µ–∑ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: <a href="https://t.me/Portaldeal">@Portaldeal</a>.',
                'faq-q3': '–ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –ø–æ–¥–∞—Ä–∫–∞–º–∏?',
                'faq-a3': '–ù–∞—à –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤: —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —à–∏—Ä–æ–∫–∏–π –≤—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤ –∏ –æ—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤. –≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∞–º–∏ –≤ Telegram.'
            },
            en: {
                profile: 'Profile',
                statistics: 'Statistics',
                balance: 'Balance',
                'deals-completed': 'Deals completed',
                'top-up-balance': 'Top up balance',
                'top-up-description': 'Add funds to account',
                'statistics-description': 'Detailed information about your deals',
                'language-settings': 'Change language',
                'back-to-profile': 'Back to profile',
                'statistics-title': 'Statistics',
                'statistics-subtitle': 'Detailed information about your deals',
                'general-stats': 'General statistics',
                'total-amount': 'Total transaction amount',
                'recent-deals': 'Recent deals',
                'faq-title': 'FAQ',
                'faq-q1': 'How do I start trading gifts?',
                'faq-a1': 'To start trading gifts, simply click the "Create Deal" button and follow the deal creation process. You\'ll need to connect your Telegram account and verify your identity.',
                'faq-q2': 'What if I have a problem with a trade?',
                'faq-a2': 'If you encounter any issues with a trade, our support team is available 24/7 to help resolve any problems. You can contact us through the support chat in the app: <a href="https://t.me/Portaldeal">@Portaldeal</a>.',
                'faq-q3': 'Why should I use bot for trading gifts?',
                'faq-a3': 'Our bot offers several key benefits: A user-friendly interface, secure transactions, a wide variety of gifts, and excellent customer support. It\'s the easiest and safest way to trade gifts within Telegram.'
            }
        };

        let currentLanguage = localStorage.getItem('lang') || 'ru';

        // Update UI based on language
        function switchLanguage(language) {
            currentLanguage = language;
            localStorage.setItem('lang', language);
            const texts = translations[language];
            Object.keys(texts).forEach(key => {
                const elements = document.querySelectorAll(`[data-i18n="${key}"]`);
                elements.forEach(el => {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = texts[key];
                    } else {
                        el.innerHTML = texts[key];
                    }
                });
            });
        }

        // Fetch profile data
        function fetchProfileData() {
            Telegram.WebApp.sendData(JSON.stringify({ action: 'get_profile', userId }));
            Telegram.WebApp.onEvent('webAppData', (data) => {
                try {
                    const profile = JSON.parse(data);
                    document.querySelector('.profile-name').textContent = profile.username || 'N/A';
                    document.querySelector('.profile-id').textContent = `ID: #${profile.userId || '123456'}`;
                    document.querySelector('#profile-balance').textContent = `${profile.balance.toFixed(2)} TON`;
                    document.querySelector('#profile-deals').textContent = profile.deals;
                } catch (e) {
                    console.error('Error parsing profile data:', e);
                }
            });
        }

        // Fetch statistics data
        function fetchStatsData() {
            Telegram.WebApp.sendData(JSON.stringify({ action: 'get_stats', userId }));
            Telegram.WebApp.onEvent('webAppData', (data) => {
                try {
                    const stats = JSON.parse(data);
                    document.querySelector('#stats-deals').textContent = stats.deals;
                    document.querySelector('#stats-total-amount').textContent = `${stats.totalAmount.toFixed(2)} TON`;
                    const recentDeals = document.querySelector('#recent-deals');
                    recentDeals.innerHTML = stats.recentDeals.map(deal => `
                        <div class="transaction-item">
                            <div class="transaction-icon">${deal.status === 'finished' ? '‚úÖ' : '‚è≥'}</div>
                            <div class="transaction-content">
                                <div class="transaction-title">${deal.title}</div>
                                <div class="transaction-details">${deal.amount.toFixed(2)} TON ‚Ä¢ ${deal.date}</div>
                            </div>
                            <div class="transaction-status ${deal.status === 'finished' ? 'success' : 'pending'}">
                                ${currentLanguage === 'ru' ? (deal.status === 'finished' ? '–ó–∞–≤–µ—Ä—à–µ–Ω–∞' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ') : (deal.status === 'finished' ? 'Completed' : 'Pending')}
                            </div>
                        </div>
                    `).join('');
                } catch (e) {
                    console.error('Error parsing stats data:', e);
                }
            });
        }

        // Fetch requisites data
        function fetchRequisitesData() {
            Telegram.WebApp.sendData(JSON.stringify({ action: 'get_requisites', userId }));
            Telegram.WebApp.onEvent('webAppData', (data) => {
                try {
                    const requisites = JSON.parse(data);
                    const content = document.querySelector('#requisites-content');
                    if (requisites.length === 0) {
                        content.innerHTML = `
                            <div style="font-size:44px;">üí≥</div>
                            <div style="margin-top:10px;font-weight:700;">–†–µ–∫–≤–∏–∑–∏—Ç—ã –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã</div>
                        `;
                    } else {
                        content.innerHTML = requisites.map(req => `
                            <div style="text-align:left;padding:10px;border-bottom:1px solid rgba(255,255,255,0.2);">
                                <div style="font-weight:700;color:#ffffff;">${req.type}</div>
                                <div style="color:#b8c5d1;">${req.value} (${req.currency})</div>
                            </div>
                        `).join('');
                    }
                } catch (e) {
                    console.error('Error parsing requisites data:', e);
                }
            });
        }

        // Tabbar navigation
        const tabbar = document.querySelector('.tabbar');
        const buttons = Array.from(tabbar.querySelectorAll('button'));
        const screens = Array.from(document.querySelectorAll('.screen'));

        function activate(targetSelector) {
            buttons.forEach(btn => {
                const isActive = btn.getAttribute('data-target') === targetSelector;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-current', isActive ? 'page' : 'false');
            });
            document.querySelectorAll('.nav-link').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-target') === targetSelector);
            });
            screens.forEach(section => {
                const isActive = '#' + section.id === targetSelector;
                section.classList.toggle('active', isActive);
                if (isActive) {
                    resetScreenAnimations(section);
                    if (section.id === 'screen-profile') fetchProfileData();
                    if (section.id === 'screen-statistics') fetchStatsData();
                    if (section.id === 'screen-requisites') fetchRequisitesData();
                }
            });
        }

        // Reset animations for active screen
        function resetScreenAnimations(screen) {
            if (screen.id === 'screen-profile') {
                const elements = [
                    { el: screen.querySelector('.profile-header'), anim: 'fadeInUp 0.8s ease-out 0.2s forwards' },
                    { el: screen.querySelector('.avatar-circle'), anim: 'scaleIn 0.6s ease-out 0.4s forwards' },
                    { el: screen.querySelector('.profile-stats'), anim: 'fadeInUp 0.8s ease-out 0.6s forwards' },
                    { el: screen.querySelector('.profile-actions'), anim: 'fadeInUp 0.8s ease-out 0.8s forwards' }
                ];
                elements.forEach(({ el, anim }) => {
                    if (el) {
                        el.style.animation = 'none';
                        el.offsetHeight;
                        el.style.animation = anim;
                    }
                });
            }
            if (screen.id === 'screen-statistics' || screen.id === 'screen-requisites') {
                const formHeader = screen.querySelector('.form-header');
                const cards = screen.querySelectorAll('.card');
                const buttons = screen.querySelectorAll('.btn-primary, .btn-secondary');
                if (formHeader) {
                    formHeader.style.animation = 'none';
                    formHeader.offsetHeight;
                    formHeader.style.animation = 'fadeInDown 0.8s ease-out 0.1s forwards';
                }
                cards.forEach((card, index) => {
                    card.style.animation = 'none';
                    card.offsetHeight;
                    card.style.animation = `fadeInUp 0.8s ease-out ${0.3 + index * 0.2}s forwards`;
                });
                buttons.forEach((button, index) => {
                    button.style.animation = 'none';
                    button.offsetHeight;
                    button.style.animation = `fadeInUp 0.6s ease-out ${0.5 + index * 0.1}s forwards`;
                });
            }
            const staggerElements = screen.querySelectorAll('.stagger-animation');
            staggerElements.forEach(container => {
                Array.from(container.children).forEach((child, index) => {
                    child.style.animation = 'none';
                    child.offsetHeight;
                    child.style.animation = `fadeInUp 0.6s ease-out ${0.1 * (index + 1)}s forwards`;
                });
            });
        }

        // Navigation handlers
        tabbar.addEventListener('click', e => {
            const btn = e.target.closest('button');
            if (btn && btn.getAttribute('data-target')) activate(btn.getAttribute('data-target'));
        });

        document.addEventListener('click', e => {
            const navBtn = e.target.closest('[data-target]');
            if (navBtn) activate(navBtn.getAttribute('data-target'));
            const ext = e.target.closest('[data-external]');
            if (ext) window.open(ext.getAttribute('data-external'), '_blank');
        });

        // FAQ toggle
        window.toggleFaq = function(button) {
            const answer = button.nextElementSibling;
            document.querySelectorAll('.faq-answer').forEach(ans => ans.classList.remove('show'));
            if (!answer.classList.contains('show')) answer.classList.add('show');
        };

        // Custom select functionality
        document.querySelectorAll('.custom-select').forEach(cs => {
            const trigger = cs.querySelector('.cs-trigger');
            const list = cs.querySelector('.cs-list');
            const valueSpan = cs.querySelector('.cs-value');
            const hidden = cs.querySelector('input[type="hidden"]');

            trigger.addEventListener('click', () => {
                const expanded = cs.getAttribute('aria-expanded') === 'true';
                document.querySelectorAll('.custom-select[aria-expanded="true"]').forEach(el => {
                    if (el !== cs) el.setAttribute('aria-expanded', 'false');
                });
                cs.setAttribute('aria-expanded', !expanded);
            });

            list.addEventListener('click', e => {
                const option = e.target.closest('.cs-option');
                if (!option) return;
                list.querySelectorAll('.cs-option').forEach(o => o.classList.toggle('selected', o === option));
                const optEmoji = option.querySelector('.emoji')?.textContent || '';
                const triggerEmojiSpan = trigger.querySelector('.emoji');
                if (triggerEmojiSpan) triggerEmojiSpan.textContent = optEmoji;
                valueSpan.textContent = option.textContent.replace(optEmoji, '').trim();
                hidden.value = option.getAttribute('data-value');
                cs.setAttribute('aria-expanded', 'false');
                if (hidden.name === 'language') {
                    switchLanguage(hidden.value);
                    Telegram.WebApp.sendData(JSON.stringify({ action: 'set_language', userId, language: hidden.value }));
                }
            });

            document.addEventListener('click', e => {
                if (!cs.contains(e.target)) cs.setAttribute('aria-expanded', 'false');
            });
        });

        // Create deal submission
        document.getElementById('create-submit').addEventListener('click', () => {
            const amountInput = document.querySelector('#screen-create .input-like[type="number"]');
            const descInput = document.querySelector('#screen-create textarea.input-like');
            const success = document.getElementById('status-success');
            const error = document.getElementById('status-error');

            success.classList.remove('show');
            error.classList.remove('show');
            error.textContent = '';

            const amount = amountInput.value.trim();
            const desc = descInput.value.trim();

            if (!amount || isNaN(amount) || amount <= 0) {
                error.textContent = currentLanguage === 'ru' ? '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É' : 'Enter a valid amount';
                error.classList.add('show');
                return;
            }
            if (desc.length < 10) {
                error.textContent = currentLanguage === 'ru' ? '–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤' : 'Description must be at least 10 characters';
                error.classList.add('show');
                return;
            }

            const data = {
                action: 'create_deal',
                dealType: document.querySelector('input[name="dealType"]').value,
                currency: document.querySelector('input[name="currency"]').value,
                amount: parseFloat(amount),
                description: desc,
                userId
            };
            Telegram.WebApp.sendData(JSON.stringify(data));
            success.classList.add('show');
            setTimeout(() => Telegram.WebApp.close(), 2000);
        });

        // Add requisites
        document.getElementById('add-requisites').addEventListener('click', () => {
            Telegram.WebApp.sendData(JSON.stringify({ action: 'add_requisites', userId }));
        });

        // Top up balance
        document.getElementById('btn-top-up').addEventListener('click', () => {
            window.open('https://t.me/Portaldeal?start=topup', '_blank');
        });

        // Back to profile
        document.getElementById('back-to-profile-stats').addEventListener('click', () => {
            activate('#screen-profile');
        });

        // Initialize stars
        function createRandomStars() {
            const starsContainer = document.querySelector('.stars');
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.top = Math.random() * 100 + '%';
                star.style.left = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }
        createRandomStars();

        // Initialize language and profile data
        switchLanguage(currentLanguage);
        fetchProfileData();
    </script>
</body>
</html>
